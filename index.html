<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mindi's Cleaning Checklist</title>

    <!-- PWA Manifest and Icons -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#FF6B9D">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Mindi's Cleaning">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">
    <style>
/* Fun color palette */
:root {
    --primary: #FF6B9D;
    --secondary: #4ECDC4;
    --accent: #FFE66D;
    --success: #7BC96F;
    --warning: #FFA07A;
    --background: linear-gradient(135deg, #667EEA 0%, #764BA2 100%);
    --card-bg: rgba(255, 255, 255, 0.95);
    --text-primary: #2C3E50;
    --text-secondary: #7F8C8D;
    --shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: var(--background);
    min-height: 100vh;
    color: var(--text-primary);
    line-height: 1.6;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

/* Header */
header {
    text-align: center;
    margin-bottom: 30px;
    background: var(--card-bg);
    padding: 30px;
    border-radius: 20px;
    box-shadow: var(--shadow);
}

header h1 {
    font-size: 2.5rem;
    margin-bottom: 20px;
    background: linear-gradient(45deg, var(--primary), var(--secondary));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.progress-section {
    margin-top: 20px;
}

.progress-section h2 {
    margin-bottom: 10px;
    color: var(--text-secondary);
}

.progress-bar {
    width: 100%;
    height: 30px;
    background: #E0E0E0;
    border-radius: 15px;
    overflow: hidden;
    margin-bottom: 10px;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--success), var(--accent));
    width: 0%;
    transition: width 0.5s ease;
    border-radius: 15px;
}

#progressText {
    font-weight: bold;
    color: var(--primary);
}

/* Navigation */
.nav-tabs {
    display: flex;
    justify-content: center;
    margin-bottom: 30px;
    background: var(--card-bg);
    border-radius: 15px;
    padding: 5px;
    box-shadow: var(--shadow);
}

.tab-button {
    background: none;
    border: none;
    padding: 12px 24px;
    border-radius: 10px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    color: var(--text-secondary);
}

.tab-button.active {
    background: var(--primary);
    color: white;
    box-shadow: 0 2px 8px rgba(255, 107, 157, 0.3);
}

.tab-button:hover:not(.active) {
    background: rgba(255, 107, 157, 0.1);
    color: var(--primary);
}

/* Main content */
main {
    background: var(--card-bg);
    border-radius: 20px;
    padding: 30px;
    box-shadow: var(--shadow);
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

.tab-content h2 {
    margin-bottom: 20px;
    color: var(--text-primary);
    text-align: center;
}

/* Task lists */
.task-list, .room-list {
    margin-bottom: 20px;
}

.task-item {
    display: flex;
    align-items: center;
    padding: 15px;
    margin-bottom: 10px;
    background: #F8F9FA;
    border-radius: 10px;
    border-left: 4px solid var(--secondary);
    transition: all 0.3s ease;
}

.task-item.completed {
    background: linear-gradient(90deg, var(--success), #A8E6CF);
    border-left-color: var(--success);
    opacity: 0.8;
}

.task-item.completed .task-text {
    text-decoration: line-through;
    color: #666;
}

.task-checkbox {
    width: 24px;
    height: 24px;
    margin-right: 15px;
    cursor: pointer;
    accent-color: var(--primary);
}

.task-text {
    flex-grow: 1;
    font-size: 1.1rem;
}

.task-actions {
    display: flex;
    gap: 10px;
}

.edit-btn, .delete-btn {
    background: none;
    border: none;
    cursor: pointer;
    font-size: 1.2rem;
    padding: 5px;
    border-radius: 5px;
    transition: background 0.3s ease;
}

.edit-btn:hover {
    background: rgba(78, 205, 196, 0.2);
}

.delete-btn:hover {
    background: rgba(255, 160, 122, 0.2);
}

/* Room sections */
.room-section {
    margin-bottom: 30px;
    border: 2px solid #E0E0E0;
    border-radius: 15px;
    padding: 20px;
}

.room-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.room-title {
    font-size: 1.5rem;
    font-weight: bold;
    color: var(--primary);
}

.room-progress {
    font-size: 0.9rem;
    color: var(--text-secondary);
}

/* Buttons */
.refresh-btn, .action-btn {
    background: linear-gradient(45deg, var(--primary), var(--secondary));
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 25px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(255, 107, 157, 0.3);
}

.refresh-btn:hover, .action-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(255, 107, 157, 0.4);
}

.action-btn.danger {
    background: linear-gradient(45deg, var(--warning), #FF6B6B);
}

.action-btn.danger:hover {
    box-shadow: 0 6px 20px rgba(255, 160, 122, 0.4);
}

/* Settings */
.settings-section {
    margin-bottom: 30px;
    padding: 20px;
    background: #F8F9FA;
    border-radius: 10px;
}

.settings-section h3 {
    margin-bottom: 15px;
    color: var(--text-primary);
}

.task-editor {
    margin-top: 15px;
}

/* Modal */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
}

.modal-content {
    background-color: white;
    margin: 15% auto;
    padding: 30px;
    border-radius: 20px;
    width: 80%;
    max-width: 500px;
    position: relative;
    text-align: center;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    animation: modalAppear 0.3s ease;
}

@keyframes modalAppear {
    from { transform: scale(0.7); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
}

@keyframes sparkle {
    0%, 100% { transform: scale(1) rotate(0deg); }
    25% { transform: scale(1.1) rotate(5deg); }
    50% { transform: scale(1.2) rotate(-5deg); }
    75% { transform: scale(1.1) rotate(3deg); }
}

@keyframes confetti {
    0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
    100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
}

.confetti {
    position: fixed;
    width: 10px;
    height: 10px;
    background: #FF6B9D;
    top: -10px;
    z-index: 1001;
    animation: confetti 3s ease-in-out forwards;
}

.confetti:nth-child(2n) { background: #4ECDC4; left: 10%; animation-delay: 0.1s; }
.confetti:nth-child(3n) { background: #FFE66D; left: 20%; animation-delay: 0.2s; }
.confetti:nth-child(4n) { background: #FF6B9D; left: 30%; animation-delay: 0.3s; }
.confetti:nth-child(5n) { background: #4ECDC4; left: 40%; animation-delay: 0.4s; }
.confetti:nth-child(6n) { background: #FFE66D; left: 50%; animation-delay: 0.5s; }
.confetti:nth-child(7n) { background: #FF6B9D; left: 60%; animation-delay: 0.6s; }
.confetti:nth-child(8n) { background: #4ECDC4; left: 70%; animation-delay: 0.7s; }
.confetti:nth-child(9n) { background: #FFE66D; left: 80%; animation-delay: 0.8s; }
.confetti:nth-child(10n) { background: #FF6B9D; left: 90%; animation-delay: 0.9s; }

.close-modal {
    position: absolute;
    right: 20px;
    top: 15px;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    color: var(--text-secondary);
}

.close-modal:hover {
    color: var(--primary);
}

/* Subheadings */
.subheading {
    background: linear-gradient(90deg, #FFE66D, #4ECDC4);
    color: white;
    padding: 8px 15px;
    margin: 15px 0 5px 0;
    border-radius: 20px;
    font-weight: bold;
    font-size: 0.9rem;
    text-align: center;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.subheading-text {
    text-transform: uppercase;
    letter-spacing: 1px;
}

/* Responsive design */
@media (max-width: 768px) {
    .container {
        padding: 10px;
    }

    header {
        padding: 20px;
    }

    header h1 {
        font-size: 2rem;
    }

    .nav-tabs {
        flex-direction: column;
    }

    .tab-button {
        margin-bottom: 5px;
    }

    main {
        padding: 20px;
    }

    .task-item {
        flex-direction: column;
        align-items: flex-start;
    }

    .task-actions {
        align-self: flex-end;
        margin-top: 10px;
    }
}
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üåü Mindi's Cleaning Adventures üåü</h1>
            <div class="progress-section">
                <h2>Overall Progress</h2>
                <div class="progress-bar">
                    <div class="progress-fill" id="overallProgress"></div>
                </div>
                <p id="progressText">Let's get cleaning!</p>
            </div>
        </header>

        <nav class="nav-tabs">
            <button class="tab-button active" data-tab="weekly">This Week's Tasks</button>
            <button class="tab-button" data-tab="rooms">All Rooms</button>
            <button class="tab-button" data-tab="baits">Change Baits</button>
            <button class="tab-button" data-tab="settings">Settings</button>
        </nav>

        <main>
            <div id="weeklyTab" class="tab-content active">
                <h2>This Week's Suggested Tasks</h2>
                <div class="progress-section" style="margin-bottom: 20px;">
                    <h3>Weekly Progress</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="weeklyProgress" style="background: linear-gradient(90deg, #4ECDC4, #FFE66D);"></div>
                    </div>
                    <p id="weeklyProgressText" style="color: #4ECDC4; font-weight: bold;">Complete your weekly tasks!</p>
                </div>
                <div id="weeklyTasks" class="task-list">
                    <!-- Weekly tasks will be populated here -->
                </div>
                <button id="refreshWeekly" class="refresh-btn">üé≤ Get New Weekly Tasks</button>
            </div>

            <div id="roomsTab" class="tab-content">
                <h2>All Cleaning Tasks</h2>
                <div id="roomList" class="room-list">
                    <!-- Rooms will be populated here -->
                </div>
            </div>

            <div id="baitsTab" class="tab-content">
                <h2>Change Baits</h2>
                <p style="text-align: center; margin-bottom: 20px; color: #666;">Check off rooms as you change the baits. This helps you keep track of which areas you've done.</p>
                <div id="baitsList" class="room-list">
                    <!-- Baits will be populated here -->
                </div>
                <div style="text-align: center; margin-top: 20px;">
                    <button id="resetBaits" class="action-btn">üîÑ Reset All Bait Checks</button>
                </div>
            </div>

            <div id="settingsTab" class="tab-content">
                <h2>Settings</h2>
                <div class="settings-section">
                    <h3>Manage Tasks</h3>
                    <button id="addRoom" class="action-btn">‚ûï Add New Room/Area</button>
                    <div id="taskEditor" class="task-editor">
                        <!-- Task editing interface -->
                    </div>
                </div>
                <div class="settings-section">
                    <h3>Reset Options</h3>
                    <button id="resetWeek" class="action-btn">üîÑ Reset Weekly Progress</button>
                    <button id="resetAll" class="action-btn danger">‚ö†Ô∏è Reset All Progress</button>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal for congratulations -->
    <div id="congratsModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <div id="congratsContent">
                <!-- Congratulatory content -->
            </div>
        </div>
    </div>

    <script>
// Mindi's Cleaning App - Main JavaScript

class CleaningApp {
    constructor() {
        this.currentWeek = this.getCurrentWeek();
        this.tasks = this.loadTasks();
        this.completedTasks = this.loadCompletedTasks();
        this.weeklyTasks = this.loadWeeklyTasks();

        this.init();
    }

    init() {
        this.setupEventListeners();
        this.renderRooms();
        this.renderWeeklyTasks();
        this.renderBaits();
        this.updateOverallProgress();
        this.updateWeeklyProgress();
        this.showWelcomeMessage();
    }

    // Local Storage Management
    loadTasks() {
        const defaultTasks = this.getDefaultTasks();
        const stored = localStorage.getItem('cleaningTasks');
        return stored ? JSON.parse(stored) : defaultTasks;
    }

    loadCompletedTasks() {
        const stored = localStorage.getItem('completedTasks');
        return stored ? JSON.parse(stored) : {};
    }

    loadWeeklyTasks() {
        const stored = localStorage.getItem('weeklyTasks');
        if (stored) {
            const parsed = JSON.parse(stored);
            // Check if weekly tasks are for current week
            if (parsed.week === this.currentWeek) {
                return parsed.tasks;
            }
        }
        return this.generateWeeklyTasks();
    }

    saveTasks() {
        localStorage.setItem('cleaningTasks', JSON.stringify(this.tasks));
    }

    saveCompletedTasks() {
        localStorage.setItem('completedTasks', JSON.stringify(this.completedTasks));
    }

    saveWeeklyTasks() {
        const weeklyData = {
            week: this.currentWeek,
            tasks: this.weeklyTasks
        };
        localStorage.setItem('weeklyTasks', JSON.stringify(weeklyData));
    }

    // Get current week number (0-51)
    getCurrentWeek() {
        const now = new Date();
        const start = new Date(now.getFullYear(), 0, 1);
        const diff = now - start;
        const oneWeek = 1000 * 60 * 60 * 24 * 7;
        return Math.floor(diff / oneWeek);
    }

    // Default tasks structure - we'll populate this with user's lists
    getDefaultTasks() {
        return {
            "Bedroom": {
                tasks: [
                    "Clean skirting boards",
                    "Clean windowsills",
                    "Wash glass doors",
                    "Wash windows",
                    "De-clutter",
                    "Vacuum",
                    "Clean air con filters",
                    "Clean mirror",
                    "--- Walk in robe ---",
                    "De-clutter",
                    "Tidy",
                    "Dust",
                    "--- Ensuite ---",
                    "De-clutter",
                    "Clean sills",
                    "Clean window",
                    "Clean wall tiles",
                    "Clean light and exhaust fan",
                    "Clean mirror",
                    "Clean shower",
                    "Clean toilet"
                ],
                baits: 2
            },
            "Lounge Room": {
                tasks: [
                    "Clean glass doors",
                    "Clean mirrors",
                    "De-clutter bookshelf",
                    "De-clutter TV cabinet",
                    "Wash leather matt",
                    "Condition couch",
                    "Dust",
                    "Clean skirting boards",
                    "Clean light shades",
                    "Dust features",
                    "Vacuum",
                    "Remove cobwebs"
                ],
                baits: 3
            },
            "Laundry": {
                tasks: [
                    "Clean cupboard tracks",
                    "De-clutter cupboards",
                    "Clean door fronts",
                    "Wipe sills",
                    "Wipe skirting boards",
                    "Dust paintings",
                    "Clean tiles"
                ],
                baits: 1
            },
            "Entries/Treadmill Area": {
                tasks: [
                    "Clean front door",
                    "Clean skylight",
                    "Clean glass",
                    "Clean mirror",
                    "Get rid of stains on matt",
                    "Clean skirting boards",
                    "De-clutter toy baskets and clean",
                    "Dust",
                    "Clean fan",
                    "Clean air con filters",
                    "Oil treadmill belt"
                ],
                baits: 2
            },
            "Dining/Family Room": {
                tasks: [
                    "Clean skirting boards",
                    "Clean back of bench",
                    "Clean chairs",
                    "Clean table",
                    "Wash runner",
                    "Wash couch cover",
                    "Dust",
                    "Vacuum couch",
                    "Dust TV",
                    "Dust speaker",
                    "Dust paintings",
                    "Clean glass doors",
                    "Clean door tracks"
                ],
                baits: 4
            },
            "Kitchen": {
                tasks: [
                    "Clean sink",
                    "Clean all benches",
                    "Clean stovetop",
                    "Clean range",
                    "Clean microwave",
                    "Clean all cupboards",
                    "Clean glass",
                    "Clean front and top fridge",
                    "Clean dishwasher",
                    "De-clutter cupboards",
                    "Clean skirting boards",
                    "Clean light",
                    "Clean skylight",
                    "Clean oven"
                ],
                baits: 3
            },
            "Sewing Room": {
                tasks: [
                    "Clean window sills",
                    "Clean skirting boards",
                    "Clean windows",
                    "Tidy room",
                    "De-clutter",
                    "New ironing board cover",
                    "Take stuff to Vinnies",
                    "Clean light fitting",
                    "Clean fan",
                    "Clean mirror"
                ],
                baits: 1
            },
            "Toilet": {
                tasks: [
                    "Clean window sills",
                    "Clean skirting boards",
                    "Clean toilet brush holder",
                    "Clean window",
                    "Check plant",
                    "Clean toilet"
                ],
                baits: 1
            },
            "Bathroom": {
                tasks: [
                    "Clean window sills",
                    "Clean tiles",
                    "Clean mirror",
                    "Clean shower",
                    "Clean door",
                    "Clean window",
                    "Check plant",
                    "De-clutter cupboard",
                    "De-clutter drawers"
                ],
                baits: 2
            },
            "Kiddies Room": {
                tasks: [
                    "Clean window sills",
                    "Clean skirting boards",
                    "Clean windows",
                    "Wash doona cover",
                    "Clean air con filter",
                    "Clean fan",
                    "Clean light shade",
                    "Run air con",
                    "De-clutter cupboard",
                    "Clean mirror",
                    "Clean slider tracks",
                    "Vacuum"
                ],
                baits: 2
            },
            "Guestroom": {
                tasks: [
                    "Clean window sills",
                    "Clean skirting boards",
                    "Clean windows",
                    "Dust fan",
                    "Dust light shade",
                    "Clean air con filter",
                    "Vacuum",
                    "De-clutter cupboard",
                    "Run air con",
                    "Clean mirror",
                    "Clean wardrobe tracks"
                ],
                baits: 1
            },
            "Outside - Entry": {
                tasks: [
                    "--- Entry ---",
                    "Wash down",
                    "Clean glass",
                    "Wash front doors",
                    "--- Courtyard ---",
                    "Wash doors",
                    "Clean and tidy area",
                    "Wash dog bed",
                    "--- Deck ---",
                    "Wash down deck",
                    "Wash furniture",
                    "Water plants",
                    "Clean windows",
                    "Clean doors",
                    "Get rid of cobwebs",
                    "Clean barbecue area"
                ],
                baits: 0
            },
        };
    }

    // Generate weekly tasks - rotate through rooms
    generateWeeklyTasks() {
        const weeklyTasks = [];
        const roomNames = Object.keys(this.tasks);

        // Select 3-5 tasks from different rooms
        const numTasks = Math.min(5, roomNames.length);
        const selectedRooms = this.shuffleArray(roomNames).slice(0, numTasks);

        selectedRooms.forEach(room => {
            const roomTasks = this.tasks[room].tasks;
            if (roomTasks.length > 0) {
                const randomTask = roomTasks[Math.floor(Math.random() * roomTasks.length)];
                weeklyTasks.push({
                    room: room,
                    task: randomTask,
                    id: `${room}-${randomTask.replace(/\s+/g, '-').toLowerCase()}`
                });
            }
        });

        return weeklyTasks;
    }

    // Utility function to shuffle array
    shuffleArray(array) {
        const shuffled = [...array];
        for (let i = shuffled.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
        }
        return shuffled;
    }

    // Event Listeners
    setupEventListeners() {
        // Tab switching
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', (e) => this.switchTab(e.target.dataset.tab));
        });

        // Weekly tasks refresh
        document.getElementById('refreshWeekly').addEventListener('click', () => this.refreshWeeklyTasks());

        // Baits reset
        document.getElementById('resetBaits').addEventListener('click', () => this.resetBaitsProgress());

        // Settings buttons
        document.getElementById('addRoom').addEventListener('click', () => this.showAddRoomForm());
        document.getElementById('resetWeek').addEventListener('click', () => this.resetWeeklyProgress());
        document.getElementById('resetAll').addEventListener('click', () => this.resetAllProgress());

        // Modal close
        document.querySelector('.close-modal').addEventListener('click', () => this.closeModal());
        document.getElementById('congratsModal').addEventListener('click', (e) => {
            if (e.target.id === 'congratsModal') this.closeModal();
        });
    }

    // Tab switching
    switchTab(tabName) {
        // Update tab buttons
        document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
        document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

        // Update tab content
        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
        document.getElementById(`${tabName}Tab`).classList.add('active');
    }

    // Render rooms and tasks
    renderRooms() {
        const roomList = document.getElementById('roomList');
        roomList.innerHTML = '';

        Object.keys(this.tasks).forEach(roomName => {
            const roomSection = this.createRoomSection(roomName);
            roomList.appendChild(roomSection);
        });
    }

    createRoomSection(roomName) {
        const section = document.createElement('div');
        section.className = 'room-section';

        const roomData = this.tasks[roomName];
        const roomTasks = roomData.tasks;
        const baitsCount = roomData.baits || 0;
        // Exclude subheadings from completion count
        const actualTasks = roomTasks.filter(task => !task.startsWith('---') || !task.endsWith('---'));
        const completedCount = actualTasks.filter(task =>
            this.isTaskCompleted(`${roomName}-${task}`)
        ).length;

        const baitInfo = baitsCount > 0 ? ` (${baitsCount} bait${baitsCount !== 1 ? 's' : ''})` : '';

        section.innerHTML = `
            <div class="room-header">
                <h3 class="room-title">${roomName}${baitInfo}</h3>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <span class="room-progress">${completedCount}/${actualTasks.length} completed</span>
                    <button class="action-btn" style="font-size: 0.8rem; padding: 5px 10px;" onclick="cleaningApp.editRoomName('${roomName}')">‚úèÔ∏è Edit Room</button>
                    <button class="action-btn" style="font-size: 0.8rem; padding: 5px 10px;" onclick="cleaningApp.addTaskToRoom('${roomName}')">‚ûï Add Task</button>
                </div>
            </div>
            <div class="task-list">
                ${roomTasks.map(task => this.createTaskElement(roomName, task)).join('')}
            </div>
        `;

        return section;
    }

    createTaskElement(roomName, task) {
        const taskId = `${roomName}-${task}`;
        const isCompleted = this.isTaskCompleted(taskId);

        // Check if this is a subheading (starts with ---)
        if (task.startsWith('---') && task.endsWith('---')) {
            return `
                <div class="subheading">
                    <span class="subheading-text">${task.replace(/---/g, '').trim()}</span>
                </div>
            `;
        }

        return `
            <div class="task-item ${isCompleted ? 'completed' : ''}" data-task-id="${taskId}">
                <input type="checkbox" class="task-checkbox" ${isCompleted ? 'checked' : ''}>
                <span class="task-text">${task}</span>
                <div class="task-actions">
                    <button class="edit-btn" title="Edit task" onclick="cleaningApp.editTask('${roomName}', '${task.replace(/'/g, "\\'")}')">‚úèÔ∏è</button>
                    <button class="delete-btn" title="Delete task" onclick="cleaningApp.deleteTask('${roomName}', '${task.replace(/'/g, "\\'")}')">üóëÔ∏è</button>
                </div>
            </div>
        `;
    }

    // Render baits management
    renderBaits() {
        const baitsContainer = document.getElementById('baitsList');
        baitsContainer.innerHTML = '';

        Object.keys(this.tasks).forEach(roomName => {
            const roomData = this.tasks[roomName];
            if (roomData.baits > 0) {
                const baitElement = document.createElement('div');
                baitElement.className = 'room-section';

                const baitId = `bait-${roomName}`;
                const isCompleted = this.isTaskCompleted(baitId);

                baitElement.innerHTML = `
                    <div class="room-header">
                        <h3 class="room-title">${roomName}</h3>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <span style="color: #666;">${roomData.baits} bait${roomData.baits !== 1 ? 's' : ''}</span>
                            <button class="action-btn" style="font-size: 0.8rem; padding: 5px 10px;" onclick="cleaningApp.editBaits('${roomName}')">Edit Count</button>
                        </div>
                    </div>
                    <div class="task-list">
                        <div class="task-item ${isCompleted ? 'completed' : ''}" data-task-id="${baitId}">
                            <input type="checkbox" class="task-checkbox" ${isCompleted ? 'checked' : ''}>
                            <span class="task-text">Change baits</span>
                        </div>
                    </div>
                `;

                baitsContainer.appendChild(baitElement);
            }
        });
    }

    // Render weekly tasks
    renderWeeklyTasks() {
        const weeklyContainer = document.getElementById('weeklyTasks');
        weeklyContainer.innerHTML = '';

        if (this.weeklyTasks.length === 0) {
            weeklyContainer.innerHTML = '<p>No weekly tasks generated yet. Click "Get New Weekly Tasks" to start!</p>';
            return;
        }

        this.weeklyTasks.forEach(weeklyTask => {
            const taskElement = document.createElement('div');
            taskElement.className = 'task-item';
            taskElement.dataset.taskId = weeklyTask.id;

            const isCompleted = this.isTaskCompleted(weeklyTask.id);

            taskElement.innerHTML = `
                <input type="checkbox" class="task-checkbox" ${isCompleted ? 'checked' : ''} data-task-id="${weeklyTask.id}">
                <span class="task-text">
                    <strong>${weeklyTask.room}:</strong> ${weeklyTask.task}
                </span>
            `;

            if (isCompleted) {
                taskElement.classList.add('completed');
            }

            weeklyContainer.appendChild(taskElement);

            weeklyContainer.appendChild(taskElement);
        });
    }

    // Task completion handling
    toggleTaskCompletion(taskId) {
        if (this.completedTasks[taskId]) {
            delete this.completedTasks[taskId];
        } else {
            this.completedTasks[taskId] = new Date().toISOString();
        }

        this.saveCompletedTasks();
        this.updateOverallProgress();
        this.updateWeeklyProgress();
        this.renderRooms(); // Refresh all rooms to show updated progress
        this.renderWeeklyTasks(); // Refresh weekly tasks
        this.renderBaits(); // Refresh baits if needed

        // Check if all weekly tasks are completed
        const weeklyCompleted = this.weeklyTasks.every(task => this.isTaskCompleted(task.id));
        if (weeklyCompleted && this.weeklyTasks.length > 0) {
            this.showCongratulations();
        }
    }

    isTaskCompleted(taskId) {
        return !!this.completedTasks[taskId];
    }

    // Progress tracking
    updateOverallProgress() {
        const totalTasks = Object.values(this.tasks).reduce((sum, room) =>
            sum + room.tasks.filter(task => !task.startsWith('---') || !task.endsWith('---')).length, 0);
        const completedTasks = Object.keys(this.completedTasks).length;
        const percentage = totalTasks > 0 ? (completedTasks / totalTasks) * 100 : 0;

        const progressFill = document.getElementById('overallProgress');
        const progressText = document.getElementById('progressText');

        progressFill.style.width = `${percentage}%`;

        if (percentage === 100) {
            progressText.textContent = "üéâ Amazing! Everything is spotless! ‚≠êüåü‚≠ê";
            this.showOverallCelebration();
        } else if (percentage >= 75) {
            progressText.textContent = `üåü Almost there! ${Math.round(percentage)}% complete ‚ú®`;
        } else if (percentage >= 50) {
            progressText.textContent = `üí™ Halfway there! ${Math.round(percentage)}% complete ‚≠ê`;
        } else if (percentage >= 25) {
            progressText.textContent = `üöÄ Getting started! ${Math.round(percentage)}% complete üåü`;
        } else {
            progressText.textContent = `‚ú® Let's get cleaning! ${Math.round(percentage)}% complete`;
        }
    }

    updateWeeklyProgress() {
        if (this.weeklyTasks.length === 0) return;

        const completedWeeklyTasks = this.weeklyTasks.filter(task => this.isTaskCompleted(task.id)).length;
        const totalWeeklyTasks = this.weeklyTasks.length;
        const percentage = (completedWeeklyTasks / totalWeeklyTasks) * 100;

        const progressFill = document.getElementById('weeklyProgress');
        const progressText = document.getElementById('weeklyProgressText');

        if (progressFill) progressFill.style.width = `${percentage}%`;

        if (progressText) {
            if (percentage === 100) {
                progressText.textContent = "üéâ Weekly goals complete! Amazing work! ‚≠êüåü‚≠ê";
                this.showWeeklyCelebration();
            } else if (percentage >= 75) {
                progressText.textContent = `üåü Almost done! ${completedWeeklyTasks}/${totalWeeklyTasks} tasks complete ‚ú®`;
            } else if (percentage >= 50) {
                progressText.textContent = `üí™ Halfway there! ${completedWeeklyTasks}/${totalWeeklyTasks} tasks done ‚≠ê`;
                if (completedWeeklyTasks === Math.ceil(totalWeeklyTasks / 2)) {
                    this.showMilestoneMessage("Halfway point reached! üí™‚≠ê");
                }
            } else if (percentage >= 25) {
                progressText.textContent = `üöÄ Getting started! ${completedWeeklyTasks}/${totalWeeklyTasks} tasks complete üåü`;
            } else {
                progressText.textContent = `‚ú® Let's tackle this week! ${completedWeeklyTasks}/${totalWeeklyTasks} tasks done`;
            }
        }
    }

    // Weekly tasks management
    refreshWeeklyTasks() {
        this.weeklyTasks = this.generateWeeklyTasks();
        this.saveWeeklyTasks();
        this.renderWeeklyTasks();
        this.updateWeeklyProgress();
    }

    // Settings functionality
    showAddRoomForm() {
        const editor = document.getElementById('taskEditor');
        editor.innerHTML = `
            <h4>Add New Room/Area</h4>
            <input type="text" id="newRoomName" placeholder="Room name" style="width: 100%; padding: 10px; margin: 10px 0; border-radius: 5px; border: 1px solid #ddd;">
            <input type="number" id="newRoomBaits" placeholder="Number of baits (0 if none)" min="0" style="width: 100%; padding: 10px; margin: 10px 0; border-radius: 5px; border: 1px solid #ddd;">
            <button id="saveRoom" class="action-btn">Save Room</button>
        `;

        document.getElementById('saveRoom').addEventListener('click', () => {
            const roomName = document.getElementById('newRoomName').value.trim();
            const baitsCount = parseInt(document.getElementById('newRoomBaits').value) || 0;
            if (roomName && !this.tasks[roomName]) {
                this.tasks[roomName] = { tasks: [], baits: baitsCount };
                this.saveTasks();
                this.renderRooms();
                this.renderBaits();
                editor.innerHTML = '';
            }
        });
    }

    resetWeeklyProgress() {
        if (confirm('Reset weekly progress? This will uncheck all weekly tasks.')) {
            this.weeklyTasks.forEach(task => {
                delete this.completedTasks[task.id];
            });
            this.saveCompletedTasks();
            this.updateOverallProgress();
            this.updateWeeklyProgress();
            this.renderRooms();
            this.renderWeeklyTasks();
        }
    }

    resetAllProgress() {
        if (confirm('Reset ALL progress? This will uncheck everything and cannot be undone!')) {
            this.completedTasks = {};
            this.saveCompletedTasks();
            this.updateOverallProgress();
            this.renderRooms();
            this.renderWeeklyTasks();
            this.renderBaits();
        }
    }

    // Task editing functionality
    editTask(roomName, oldTask) {
        const newTask = prompt('Edit task:', oldTask);
        if (newTask && newTask.trim() !== oldTask) {
            const roomData = this.tasks[roomName];
            const taskIndex = roomData.tasks.indexOf(oldTask);
            if (taskIndex !== -1) {
                // Remove old completion status
                const oldTaskId = `${roomName}-${oldTask}`;
                if (this.completedTasks[oldTaskId]) {
                    delete this.completedTasks[oldTaskId];
                }

                // Update task
                roomData.tasks[taskIndex] = newTask.trim();
                this.saveTasks();
                this.saveCompletedTasks();
                this.renderRooms();
                this.renderWeeklyTasks();
            }
        }
    }

    deleteTask(roomName, task) {
        if (confirm(`Delete task "${task}"?`)) {
            const roomData = this.tasks[roomName];
            const taskIndex = roomData.tasks.indexOf(task);
            if (taskIndex !== -1) {
                // Remove completion status
                const taskId = `${roomName}-${task}`;
                if (this.completedTasks[taskId]) {
                    delete this.completedTasks[taskId];
                }

                // Remove task
                roomData.tasks.splice(taskIndex, 1);
                this.saveTasks();
                this.saveCompletedTasks();
                this.renderRooms();
                this.renderWeeklyTasks();
                this.renderBaits();
            }
        }
    }

    addTaskToRoom(roomName) {
        const newTask = prompt('Add new task:');
        if (newTask && newTask.trim()) {
            const roomData = this.tasks[roomName];
            roomData.tasks.push(newTask.trim());
            this.saveTasks();
            this.renderRooms();
        }
    }

    editRoomName(oldRoomName) {
        const newRoomName = prompt('Rename room to:', oldRoomName);
        if (newRoomName && newRoomName.trim() !== oldRoomName && newRoomName.trim()) {
            const trimmedNewName = newRoomName.trim();

            // Check if new name already exists
            if (this.tasks[trimmedNewName]) {
                alert('A room with this name already exists!');
                return;
            }

            // Rename the room
            this.tasks[trimmedNewName] = this.tasks[oldRoomName];
            delete this.tasks[oldRoomName];

            // Update completion data for tasks
            const updatedCompletions = {};
            Object.keys(this.completedTasks).forEach(taskId => {
                if (taskId.startsWith(`${oldRoomName}-`)) {
                    const newTaskId = taskId.replace(`${oldRoomName}-`, `${trimmedNewName}-`);
                    updatedCompletions[newTaskId] = this.completedTasks[taskId];
                } else {
                    updatedCompletions[taskId] = this.completedTasks[taskId];
                }
            });
            this.completedTasks = updatedCompletions;

            // Update weekly tasks
            this.weeklyTasks.forEach(task => {
                if (task.room === oldRoomName) {
                    task.room = trimmedNewName;
                    task.id = `${trimmedNewName}-${task.task.replace(/\s+/g, '-').toLowerCase()}`;
                }
            });

            this.saveTasks();
            this.saveCompletedTasks();
            this.saveWeeklyTasks();
            this.renderRooms();
            this.renderWeeklyTasks();
            this.renderBaits();
            this.updateOverallProgress();
        }
    }

    editBaits(roomName) {
        const roomData = this.tasks[roomName];
        const newCount = prompt(`Number of baits in ${roomName}:`, roomData.baits);
        const count = parseInt(newCount);
        if (!isNaN(count) && count >= 0) {
            // If reducing baits and this room was completed, uncheck it
            if (count === 0 && this.isTaskCompleted(`bait-${roomName}`)) {
                delete this.completedTasks[`bait-${roomName}`];
                this.saveCompletedTasks();
            }
            roomData.baits = count;
            this.saveTasks();
            this.renderRooms();
            this.renderBaits();
            this.updateOverallProgress();
        }
    }

    resetBaitsProgress() {
        if (confirm('Reset all bait checks? This will uncheck all bait changes.')) {
            Object.keys(this.tasks).forEach(roomName => {
                const baitId = `bait-${roomName}`;
                if (this.completedTasks[baitId]) {
                    delete this.completedTasks[baitId];
                }
            });
            this.saveCompletedTasks();
            this.renderBaits();
            this.updateOverallProgress();
        }
    }

    // Modal and congratulations
    showCongratulations() {
        const messages = [
            "üéâ Fantastic job! You're a cleaning superstar! ‚≠ê‚≠ê‚≠ê",
            "üåü Wow! Everything looks amazing! ‚ú®‚ú®‚ú®",
            "üí´ You did it! Time for a well-deserved break! üåàüéä",
            "üèÜ Champion cleaner! You're unstoppable! üèÖüéØ",
            "üéä Incredible work! The house is sparkling! ‚ú®üíé‚ú®",
            "üéâ You are absolutely amazing! Keep shining! ‚≠êüåü‚≠ê",
            "üí´ Outstanding work! You're a cleaning wizard! üßô‚Äç‚ôÄÔ∏è‚ú®",
            "üèÜ Victory is yours! Amazing achievement! üéØüéâ"
        ];

        const randomMessage = messages[Math.floor(Math.random() * messages.length)];

        document.getElementById('congratsContent').innerHTML = `
            <h2>üéâ Congratulations! üéâ</h2>
            <p style="font-size: 1.2rem; margin: 15px 0;">${randomMessage}</p>
            <div style="font-size: 4rem; margin: 25px 0; animation: sparkle 2s ease-in-out;">üéâ‚ú®üèÜ‚≠êüí´üåüüéä</div>
            <p style="font-weight: bold; color: #FF6B9D;">Ready for next week's tasks?</p>
        `;

        document.getElementById('congratsModal').style.display = 'block';
        this.createConfetti();
    }

    closeModal() {
        document.getElementById('congratsModal').style.display = 'none';
    }

    createConfetti() {
        // Create 50 confetti pieces
        for (let i = 0; i < 50; i++) {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            confetti.style.left = Math.random() * 100 + '%';
            confetti.style.animationDelay = Math.random() * 2 + 's';
            confetti.style.background = ['#FF6B9D', '#4ECDC4', '#FFE66D', '#FF6B9D', '#4ECDC4'][Math.floor(Math.random() * 5)];
            document.body.appendChild(confetti);

            // Remove confetti after animation
            setTimeout(() => {
                if (confetti.parentNode) {
                    confetti.parentNode.removeChild(confetti);
                }
            }, 4000);
        }
    }

    showWeeklyCelebration() {
        // Small confetti burst for weekly completion
        setTimeout(() => {
            for (let i = 0; i < 30; i++) {
                const sparkle = document.createElement('div');
                sparkle.textContent = '‚≠ê';
                sparkle.style.position = 'fixed';
                sparkle.style.left = Math.random() * 100 + '%';
                sparkle.style.top = '50%';
                sparkle.style.fontSize = '2rem';
                sparkle.style.zIndex = '1001';
                sparkle.style.animation = 'confetti 2s ease-out forwards';
                sparkle.style.pointerEvents = 'none';
                document.body.appendChild(sparkle);

                setTimeout(() => {
                    if (sparkle.parentNode) {
                        sparkle.parentNode.removeChild(sparkle);
                    }
                }, 2000);
            }
        }, 500);
    }

    showMilestoneMessage(message) {
        // Quick milestone notification
        const notification = document.createElement('div');
        notification.textContent = message;
        notification.style.position = 'fixed';
        notification.style.top = '20%';
        notification.style.left = '50%';
        notification.style.transform = 'translateX(-50%)';
        notification.style.background = 'linear-gradient(45deg, #FF6B9D, #4ECDC4)';
        notification.style.color = 'white';
        notification.style.padding = '15px 25px';
        notification.style.borderRadius = '25px';
        notification.style.fontWeight = 'bold';
        notification.style.fontSize = '1.1rem';
        notification.style.zIndex = '1001';
        notification.style.boxShadow = '0 4px 15px rgba(0,0,0,0.3)';
        notification.style.animation = 'modalAppear 0.5s ease-out';

        document.body.appendChild(notification);

        setTimeout(() => {
            notification.style.animation = 'sparkle 0.5s ease-in';
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 500);
        }, 2000);
    }

    showOverallCelebration() {
        // Special celebration for completing everything
        setTimeout(() => {
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.animationDelay = Math.random() * 3 + 's';
                confetti.style.background = ['#FF6B9D', '#4ECDC4', '#FFE66D', '#FF1493', '#00CED1'][Math.floor(Math.random() * 5)];
                document.body.appendChild(confetti);

                setTimeout(() => {
                    if (confetti.parentNode) {
                        confetti.parentNode.removeChild(confetti);
                    }
                }, 6000);
            }
        }, 300);
    }

    showWelcomeMessage() {
        // Show a brief welcome message on first load
        if (!localStorage.getItem('hasVisited')) {
            setTimeout(() => {
                alert("Welcome to Mindi's Cleaning Adventures! üéâ\n\nStart by checking out 'This Week's Tasks' or browse all rooms in the 'All Rooms' tab.");
                localStorage.setItem('hasVisited', 'true');
            }, 1000);
        }
    }
}

// Initialize the app when DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
    new CleaningApp();
});

// Add event delegation for dynamically created elements
document.addEventListener('change', (e) => {
    if (e.target.classList.contains('task-checkbox')) {
        const taskItem = e.target.closest('.task-item');
        const taskId = taskItem.dataset.taskId;
        if (taskId) {
            // Find the app instance and toggle completion
            // This is a bit hacky, but works for this simple app
            const app = window.cleaningApp;
            if (app) {
                app.toggleTaskCompletion(taskId);
            }
        }
    }
});

// Store app instance globally for event delegation
let cleaningApp;
document.addEventListener('DOMContentLoaded', () => {
    cleaningApp = new CleaningApp();
    window.cleaningApp = cleaningApp;
});
    </script>
</body>
</html>
